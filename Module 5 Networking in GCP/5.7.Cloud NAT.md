# Cloud NAT (Network Address Translation) â€“ GCP

In **Google Cloud Platform (GCP)**, **Cloud NAT** allows **private VMs (without external IP addresses)** to access the internet **securely**, while preventing inbound internet connections.

ğŸ‘‰ Private VM â†’ Cloud NAT â†’ Internet
ğŸ‘‰ Internet âŒ cannot initiate connection to private VM

---

# ğŸ¢ Real-World Example

### Scenario: Enterprise Backend Server

You have:

* Private App Server (no external IP)
* Needs to:

  * Download OS updates
  * Pull Docker images
  * Access external APIs

Security Requirement:
âŒ No inbound internet access
âœ” Only outbound internet access

Solution:
Use **Cloud NAT**

---

# ğŸ” How Cloud NAT Works (Concept)

1. Private VM sends traffic to internet (e.g., 8.8.8.8).
2. Traffic reaches VPC routing table.
3. Default route (0.0.0.0/0) forwards traffic to Internet Gateway.
4. Cloud NAT intercepts outbound traffic.
5. Cloud NAT replaces:

   * Private IP â†’ Public NAT IP
6. Response traffic returns to NAT.
7. NAT maps it back to original private VM.

This process is called **Source NAT (SNAT)**.

---

# ğŸ§ª Step-by-Step Lab: Build Cloud NAT from Scratch

---

# Step 1ï¸âƒ£ Create Custom VPC

Go to:

VPC Network â†’ Create VPC

Configuration:

* Name: `nat-vpc`
* Subnet mode: Custom
* Subnet:

  * Name: `private-subnet`
  * Region: us-central1
  * IP range: 10.0.0.0/24

Create VPC.

---

# Step 2ï¸âƒ£ Create Private VM (No External IP)

Go to:

Compute Engine â†’ Create VM

Configuration:

* Name: `private-vm`
* Region: us-central1
* Subnet: private-subnet
* External IP: None

Create VM.

---

# Step 3ï¸âƒ£ Verify No Internet Access

SSH into VM via:

* IAP (browser SSH)

Run:

```
ping 8.8.8.8
```

âŒ It will fail (no internet access).

---

# Step 4ï¸âƒ£ Create Cloud Router

Go to:

VPC Network â†’ Cloud Routers â†’ Create Router

Configuration:

* Name: `nat-router`
* Network: nat-vpc
* Region: us-central1

Create.

---

# Step 5ï¸âƒ£ Create Cloud NAT

Go to:

VPC Network â†’ NAT â†’ Create NAT Gateway

Configuration:

* Name: `nat-config`
* Region: us-central1
* Network: nat-vpc
* Cloud Router: nat-router
* NAT IP allocation: Auto-allocate
* Subnet selection:

  * Choose private-subnet
  * Select â€œAll IP rangesâ€

Create.

---

# Step 6ï¸âƒ£ Test Internet Access

SSH into private-vm again.

Run:

```
ping 8.8.8.8
```

âœ” Now it works.

Private VM can access internet securely.

---

# ğŸ”„ Traffic Flow Explanation

Before NAT:

Private VM â†’ Internet âŒ (blocked)

After NAT:

Private VM (10.0.0.2)
â†“
Cloud NAT replaces source IP
â†“
Public NAT IP (e.g., 35.x.x.x)
â†“
Internet
â†“
Response comes back
â†“
Cloud NAT maps it back to 10.0.0.2

Internet never sees private IP.

---

# ğŸ” Why Cloud NAT Is Secure

âœ” No inbound connections allowed
âœ” Only outbound sessions tracked
âœ” Stateful translation
âœ” Fully managed (no VM needed)

---

# ğŸ— Enterprise Use Case

Bank architecture:

* App servers in private subnet
* No external IPs
* Cloud NAT used for:

  * Patch updates
  * API calls
  * Container image pulls

Attackers cannot directly reach backend servers.

---

# ğŸ“Œ Important Notes

* Cloud NAT works only for outbound traffic.
* Requires Cloud Router.
* No need for external IP on VM.
* Does not support inbound NAT (use Load Balancer for that).

---

# ğŸ§  Interview-Ready Explanation

Cloud NAT enables private VMs to access the internet without assigning external IPs. It performs source network address translation using a managed public IP while blocking inbound traffic, improving security and simplifying architecture.

---

# âœ… In Simple Words

Cloud NAT:

* Gives internet to private VMs
* Hides private IPs
* Blocks inbound internet
* Uses public NAT IP for outbound traffic


